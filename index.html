<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>GNU English Practice - Gemini AI</title>
    <style>
        :root { --gnu-blue: #004c97; --gnu-gold: #a78b45; }
        body { font-family: 'Pretendard', sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        .app-card { background: white; width: 100%; max-width: 600px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; border-top: 8px solid var(--gnu-blue); }
        h1 { color: var(--gnu-blue); text-align: center; font-size: 26px; margin-bottom: 5px; }
        .sub-title { text-align: center; color: #666; font-size: 14px; margin-bottom: 25px; }
        section { margin-bottom: 25px; padding: 18px; border-radius: 12px; background: #f8fafc; border: 1px solid #e2e8f0; }
        h3 { font-size: 15px; margin-top: 0; color: var(--gnu-blue); text-transform: uppercase; letter-spacing: 1px; }
        textarea { width: 100%; height: 90px; border: 1px solid #ddd; border-radius: 10px; padding: 12px; box-sizing: border-box; font-size: 16px; margin-bottom: 10px; }
        button { width: 100%; padding: 14px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 15px; transition: 0.2s; margin-top: 5px; }
        .btn-ai { background: var(--gnu-blue); color: white; }
        .btn-ai:disabled { background: #94a3b8; }
        .btn-speak { background: #10b981; color: white; margin-top: 10px; }
        .btn-record { background: #ef4444; color: white; margin-top: 10px; }
        .result-label { font-size: 12px; color: #64748b; margin-bottom: 4px; display: block; }
        .result-box { font-size: 18px; font-weight: 600; color: #1e293b; min-height: 50px; margin-bottom: 15px; padding: 15px; background: white; border-radius: 10px; border: 1px dashed var(--gnu-blue); line-height: 1.5; }
        .score-circle { width: 100px; height: 100px; border-radius: 50%; border: 5px solid var(--gnu-gold); display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 20px auto; color: var(--gnu-blue); }
        .score-num { font-size: 32px; font-weight: 800; }
        .feedback { font-size: 14px; color: #475569; line-height: 1.6; white-space: pre-wrap; background: #fffbe6; padding: 15px; border-radius: 10px; }
        #loading { display: none; text-align: center; font-size: 14px; color: var(--gnu-blue); margin: 10px 0; }
    </style>
</head>
<body>
<div class="app-card">
    <div style="text-align: center; margin-bottom: 20px;">
        <img src="jinu.png" alt="Jinu" style="width: 120px; height: auto;">
    </div>
    
    <h1>GNU English Practice</h1>
    <p class="sub-title">Humanities-based English Speaking Lab</p>
    ```
    <section>
        <h3>Step 1. ì˜ì‘ ë° êµì •</h3>
        <textarea id="userInput" placeholder="ì—°ìŠµí•˜ê³  ì‹¶ì€ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        <button id="refineBtn" class="btn-ai" onclick="refineWithAI()">AI ë¬¸ì¥ êµì • ì‹¤í–‰</button>
        <div id="loading">AIê°€ ë¬¸ì¥ì„ ë‹¤ë“¬ê³  ìˆìŠµë‹ˆë‹¤...</div>
        <div style="margin-top:20px;">
            <span class="result-label">êµì •ëœ ë¬¸ì¥ (AI Refined):</span>
            <div id="refinedResult" class="result-box">ë¬¸ì¥ì„ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>
            <button class="btn-speak" onclick="listenNative()">ğŸ”Š ì›ì–´ë¯¼ ë°œìŒ ë“£ê¸°</button>
        </div>
    </section>

    <section id="step2" style="display:none;">
        <h3>Step 2. ë§í•˜ê¸° ì—°ìŠµ ë° í‰ê°€</h3>
        <button id="recordBtn" class="btn-record" onclick="startRecording()">ğŸ¤ ë°œìŒ ì‹œì‘ (í´ë¦­)</button>
        
        <div id="evaluationArea" style="display:none;">
            <div class="score-circle">
                <span style="font-size:12px;">SCORE</span>
                <span class="score-num" id="scoreValue">0.0</span>
            </div>
            <div class="feedback" id="feedbackDetail"></div>
        </div>
    </section>
</div>

<script>
    // êµìˆ˜ë‹˜ì˜ API í‚¤ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.
    const API_KEY = 'AIzaSyDiyy6UJeoRRPC8WSQeAm7Z7Dwxq7ZnVXE';
    let refinedText = "";
    const synth = window.speechSynthesis;

    async function refineWithAI() {
        const userInput = document.getElementById('userInput').value;
        if (!userInput) return alert("ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        const btn = document.getElementById('refineBtn');
        const loading = document.getElementById('loading');
        btn.disabled = true;
        loading.style.display = "block";

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `You are a professional English teacher. Refine this sentence to be natural and academic. Result only: "${userInput}"`
                        }]
                    }]
                })
            });

            const data = await response.json();
            refinedText = data.candidates[0].content.parts[0].text.trim();
            document.getElementById('refinedResult').innerText = refinedText;
            document.getElementById('step2').style.display = "block";
        } catch (error) {
            console.error(error);
            alert("AI ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. API í‚¤ë‚˜ ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.");
        } finally {
            btn.disabled = false;
            loading.style.display = "none";
        }
    }

    function listenNative() {
        if (!refinedText) return;
        synth.cancel();
        const utter = new SpeechSynthesisUtterance(refinedText);
        utter.lang = 'en-US';
        utter.rate = 0.85;
        synth.speak(utter);
    }

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';

    function startRecording() {
        recognition.start();
        document.getElementById('recordBtn').innerText = "ğŸ”´ ë“£ê³  ìˆìŠµë‹ˆë‹¤...";
    }

    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase();
        const confidence = event.results[0][0].confidence;
        
        document.getElementById('evaluationArea').style.display = "block";
        const finalScore = (confidence * 5).toFixed(1);
        document.getElementById('scoreValue').innerText = finalScore;
        document.getElementById('recordBtn').innerText = "ğŸ¤ ë‹¤ì‹œ ë§í•˜ê¸°";
        
        document.getElementById('feedbackDetail').innerText = `[ì¸ì‹ ê²°ê³¼]\n"${transcript}"\n\nAIê°€ ë¶„ì„í•œ ë°œìŒ ì •í™•ë„ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì„œ ì ìˆ˜ë¥¼ ë†’ì—¬ë³´ì„¸ìš”!`;
    };
</script>

</body>
</html>

